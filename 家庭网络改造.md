#读书《Openwrt》,作者Lambert M. Surhone.

借用这本书来做一次技术总结，因为花在家里路由器配置改造上一周多时间（主要涉及OpenWRT功能实现），这么多时间本来可以看几本书了。但是总结实现的功能，这一周的时间花的还是很值得的。

言归正传，先说一下这次家里路由器配置改造的缘起，北京移动逐个给金卡用户打电话，承诺不加价的基础上，升级家用光猫到1000MB，且送两个路由器分别覆盖家里不同空间，再送一个机顶盒可以观看北京移动的IPTV电视节目，当然这里还有一个隐含条件（很多用户并不关心，而实际上作用巨大），就是北京移动IPTV信号口可以独立出来。

按照未升级前的北京移动赠送的光猫都是配置成PPPoE模式，如果想用北京移动IPTV信号口，就必须把PPPoE功能转移到自己的路由器上，这就设计将光猫内置的路由器功能闲置，而且要将PPPoE功能改成桥接功能，很可能就会失败，家庭断网，造成家庭矛盾。有了这样一次免费升级而且IPTV信号口独立配置的机会，当然是不可以错过的。

整个改造涉及的硬件包括移动光猫，以及两个独立的路由器（其中一个是Raspberry P3，一个是小米R30U），这两个路由器都可以刷成OpenWRT，方便后续配置。

Raspberry路由器做光猫后的旁路由，提供不可说功能提供者，当然通过配置可以不经过旁路由，直接访问internet，但是失去了不可说功能。

小米R30U路由器做IPTV信号单播和多播转换。通过这次改造，将北京移动的机顶盒用小米R30U路由器取代，这样家中任何一台联网设备都可以通过网络观看北京移动IPTV电视节目，而且播放电视节目带宽不占用主路由的带宽，非常适合家庭娱乐。

中间改造折腾的过程坎坷不断，问题多多，包括刷机OpenWRT，配置不可说功能，抓包破解机顶盒鉴权码，IPv6地址设置等等。最终实现的功能如下：
1，不可说功能；可选择是否需要此功能，避免上网配置问题，引起家庭矛盾。
2，在Raspberry上运行Docker，时时同步最新IPTV节目单；
3，小米R30U实现机顶盒功能，实时提供经过IPTV端口的多播和单播服务，大大提供电视节目秒开的速度
4，尝试了电视和移动设备上最佳的IPTV播放器，可以同时播放IPTV节目，如果选择IPv6链路，可观看节目数量和稳定程度将大大增强。
5，国外IPTV节目可以日常观看。

改造完成后，总结整个过程，发现其实可以将这两个路由器功能集合到一个路由器（至少有两个千兆网口，空间要至少2TB以上，内存4G以上）就可以实现以上功能，但是这样的NAS设备，比如群晖，QNAP等都要将近2000+的花费，而此次改造最多500元，相较之下性价比还是很突出的。

总之这是一次非常有意义的家庭网络改造实践，实践的结果打破了电信部门希望将电视节目固化在机顶盒上以期未来收费的目的。未来不知道中国电视发展之路将走向何方，但是收费电视就是一条死路，技术上完全可以绕过这些限制。